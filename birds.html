<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Bird Migration</title>


    <link rel='stylesheet' href='https://d3-geomap/css/d3.geomap.css'>



</head>

<body>

    <body>
        <div id="map">
            <!-- 		<canvas width="960" height="600"></canvas> -->
            <svg id="usa" width="960" height="600" fill="none" stroke="#000" stroke-linejoin="round" stroke-linecap="round"></svg>
        </div>
    </body>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
    <script src='https://d3js.org/d3.v4.min.js'></script>
    <script src='https://unpkg.com/topojson-client@3'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.5.0/proj4.js'></script>



    <script>
        birdData = []
        $.getJSON('birdData.json', function (data) {
            w = 960;
            h = 600;
            var source = new proj4.Proj("EPSG:3857");
            var dest = new proj4.Proj("EPSG:4326");
            birdData = data;
            temp = birdData;
            for (i = 0; i < birdData.features.length; i++) {
                for (j = 0; j < birdData.features[i].geometry.coordinates[0][0].length; j++) {
                    temp.features[i].geometry.coordinates[0][0][j] = proj4(
                        source,
                        dest,
                        birdData.features[i].geometry.coordinates[0][0][j]
                    );
                }
            }
            drawMap();
            var projection = d3.geoAlbersUsa().translate([w / 2, h / 2]);

            var path = d3.geoPath().projection(projection);

            //Define path generator
            var path = d3.geoPath();
            svg = d3.select("#usa");
            svg
                .selectAll("path")
                .data(temp.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("fill", function (d, i) {
                    return "ff5500";
                });
            console.log(data);
        });

        function drawMap() {
            var projection = d3.geoAlbersUsa().translate([w / 2, h / 2]);

            var path = d3.geoPath().projection(projection);

            var svg = d3.select("svg");

            var path = d3.geoPath();

            d3.json("usa.json", function (error, us) {
                if (error) throw error;

                // svg.append("path")
                //     .attr("stroke", "#aaa")
                //     .attr("stroke-width", 0.5)
                //     .attr("d", path(topojson.mesh(us, us.objects.counties, function(a, b) { return a !== b && (a.id / 1000 | 0) === (b.id / 1000 | 0); })));

                svg
                    .append("path")
                    .attr("stroke-width", 0.5)
                    .attr(
                        "d",
                        path(
                            topojson.mesh(us, us.objects.states, function (a, b) {
                                return a !== b;
                            })
                        )
                    );

                svg.append("path").attr("d", path(topojson.feature(us, us.objects.nation)));
            });
        }
    </script>




</body>

</html>